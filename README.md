# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Продук\
Описывает структуру данных товара в системе. 
Используется для представления данных о товаре в каталоге и корзине

```
interface IProduct {
id: string - Уникальный идентификатор товара
description: string - Описание товара
image: string - Картинка товара
title: string - Название товара
category: string - Категория товара
price: string - Цена товара
}
```

Заказ\
Содержит информацию о оформляемом заказе.
Используется для создания и отправки заказа на сервер

```
interface IOrder {
payment: TOrderPayment - Способ оплаты заказа
email: string - Email покупателя
phone: string - Телефон покупателя
address: string - Адрес доставки
total: number - Общая сумма заказа
items: string[] - Массив идентификаторов товаров в заказе
}
```

Информация о заказе\
Содержит базовую информацию о созданном заказе.
Используется для отображения подтверждения заказа.

```
interface IOrderInfo {
id: string,
total: number
}
```

Ответ с сервера\
Структура ответа сервера на запрос списка товаров.
Используется для обработки ответа от API при загрузке каталога товаров

```
interface IGetProductListResponce {
total: number,
items: TProductList
}
```

Тип способы оплаты\
Определяет возможные способы оплаты заказа.
Используется для валидации и обработки выбора способа оплаты.

```
type TOrderPayment = "online" | "upon_receipt";
```

Тип списка товаров\
Определяет структуру массива товаров.
Используется для типизации списков товаров в различных компонентах системы.

```
type TProductList = [IProduct];
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой модель

#### Класс ModelCart
Класс управляет состоянием корзины покупок: хранит товары, обеспечивает их добавление/удаление, подсчет стоимости и уведомляет систему об изменениях.

Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- items: IProduct[] - массив товаров в корзине. Каждый товар содержит:
- id (идентификатор)
- title (название)
- price (цена)
- category (категория)
- image (изображение)
- description (описание)
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- addCart(product: IProduct): void - добавляет товар в корзину, вызывает событие cart:changed
- deleteCart(id: string): void - удаляет товар по ID, вызывает событие cart:changed
- getItems(): IProduct[] - возвращает все товары корзины
- getTotalCount(): number - возвращает количество товаров
- getTotal(): number - вычисляет общую стоимость
- hasItem(id: string): boolean - проверяет наличие товара по ID
- clearCart(): void - полностью очищает корзину

#### Класс ModelOrder
Класс управляет данными заказа: хранит информацию о способе оплаты, адресе доставки, контактных данных и обеспечивает валидацию заказа.

Конструктор
- events: EventEmitter - система событий для оповещения об изменениях данных заказа

Поля класса
- _order: IModelOrder - объект заказа, содержащий:
- payment: TOrderPayment - способ оплаты ("online" или "upon_receipt")
- address: string - адрес доставки
- email: string - email покупателя
- phone: string - телефон покупателя
- total: number - общая сумма заказа
- items: string[] - массив идентификаторов товаров
- events: EventEmitter - система событий для генерации уведомлений

Методы для взаимодействия с этими данными:
- setPayment(method: TOrderPayment): void - устанавливает способ оплаты, вызывает событие order.payment:changed
- setAddress(address: string): void - устанавливает адрес доставки, вызывает событие order.address:changed
- setEmail(email: string): void - устанавливает email, вызывает событие order.email:changed
- setPhone(phone: string): void - устанавливает телефон, вызывает событие order.phone:changed
- setOrder(data: Partial<IModelOrder>): void - обновляет данные заказа, вызывает событие order:changed
- getOrder(): IModelOrder - возвращает текущие данные заказа
- validateOrder(): boolean - проверяет валидность заказа (все поля заполнены)
- clearOrder(): void - сбрасывает данные заказа к初始状态

#### Класс ModelProductList
Класс управляет списком товаров: хранит каталог продукции, предоставляет доступ к товарам и уведомляет об изменениях в списке.

Конструктор
events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Поля класса
- items: IProduct[] - массив товаров в каталоге. Каждый товар содержит данные в формате IProduct:
- id (идентификатор)
- title (название)
- price (цена)
- category (категория)
- image (изображение)
- description (описание)
- events: IEvents - система событий для генерации уведомлений

Методы
- getItems(): any[] - возвращает полный массив товаров каталога
- setItems(items: any[]): void - сохраняет новый массив товаров, вызывает событие items:changed
- getItemById(id: string): IProduct | undefined - находит и возвращает товар по идентификатору

### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс ViewPage
Класс расширяет базовый Component и реализует представление главной страницы. Отвечает за отображение каталога товаров, счетчика корзины и обработку взаимодействия с пользователем.

Конструктор
- container: HTMLElement - корневой элемент контейнера страницы
- events: IEvents - система событий для обработки пользовательских действий
Элементы разметки
- .gallery - контейнер для карточек товаров (сохраняется в productContainer)
- .header__basket - кнопка корзины в шапке (сохраняется в cartButtonElement)
- .header__basket-counter - элемент счетчика товаров (сохраняется в counterElement)

Поля класса
- productContainer: HTMLElement - контейнер для отображения карточек товаров
- counterElement: HTMLElement - элемент для отображения счетчика товаров в корзине
- cartButtonElement: HTMLButtonElement - кнопка открытия корзины
- _wrapper: HTMLElement - основной контейнер представления

Методы:
Сеттеры
- catalog: HTMLElement[] - устанавливает массив HTML-элементов карточек товаров в контейнер
- counter: number - устанавливает значение счетчика товаров в корзине

Обработчики событий
Клик по кнопке корзины генерирует событие 'cart:open' для открытия модального окна корзины

#### Класс ViewModal
Класс расширяет базовый Component и реализует модальное окно. Отвечает за открытие, закрытие и отображение контента в модальном окне.

Конструктор
- container: HTMLElement - корневой элемент модального окна

Элементы разметки
- .modal__content - контейнер для контента модального окна (сохраняется в _modalContent)
- .modal__close - кнопка закрытия модального окна (сохраняется в _closeButton)

Поля класса
- modalView: HTMLElement - основной контейнер модального окна
- _modalContent: HTMLElement - элемент для отображения контента
- _closeButton: HTMLButtonElement - кнопка закрытия модального окна

Методы:
Сеттеры:
- content: HTMLElement - устанавливает HTML-элемент в качестве контента модального окна
Основные методы
- open(element?: HTMLElement): void - открывает модальное окно, опционально принимает элемент для отображения
- close(): void - закрывает модальное окно и очищает контент
- render(data?: any): HTMLElement - рендерит компонент (наследуется от базового класса)

Обработчики событий
Клик по кнопке закрытия вызывает метод close()
Клик по затемненной области вокруг модального окна вызывает метод close()

#### Класс ViewCartModal
Класс расширяет базовый Component и реализует модальное окно корзины покупок. Отвечает за отображение товаров в корзине, общей стоимости и обработку действий пользователя.
Конструктор
- container: HTMLElement - корневой элемент модального окна корзины
- events: IEvents - система событий для обработки пользовательских действий

Элементы разметки
- .basket__button - кнопка оформления заказа (сохраняется в _orderButton)
- .basket__price - элемент отображения общей стоимости (сохраняется в _totalPrice)
- .basket__list - контейнер списка товаров (сохраняется в _listElement)
- .basket__item-delete - кнопки удаления товара из корзины
- .basket__item - элементы товаров в корзине (с атрибутом data-id)

Поля класса
- _orderButton: HTMLButtonElement - кнопка оформления заказа
- _totalPrice: HTMLElement - элемент отображения общей стоимости
- _listElement: HTMLElement - контейнер списка товаров
- _products: IProduct[] - массив товаров в корзине

Методы
Сеттеры
- products: HTMLElement[] - устанавливает массив HTML-элементов товаров в список, управляет состоянием кнопки оформления
- total: number - устанавливает общую стоимость корзины

Обработчики событий
- Клик по кнопке оформления заказа генерирует событие 'cart:order'
- Клик по кнопкам удаления товара генерирует событие 'product:remove' с идентификатором товара

#### Класс ViewCartProductItem
Класс расширяет базовый Component и реализует элемент товара в корзине покупок. Отвечает за отображение информации о товаре и обработку действий пользователя.

Конструктор
- container: HTMLElement - корневой элемент элемента товара в корзине
- events: EventEmitter - система событий для обработки пользовательских действий

Элементы разметки
- .basket__item-index - элемент отображения порядкового номера товара (сохраняется в _indexElement)
- .card__title - элемент отображения названия товара (сохраняется в _titleElement)
- .card__price - элемент отображения цены товара (сохраняется в _priceElement)
- .basket__item-delete - кнопка удаления товара из корзины (сохраняется в _buttonElement)

Поля класса
- itemCart: HTMLElement - основной контейнер элемента товара
- _indexElement: HTMLElement - элемент для отображения порядкового номера
- _titleElement: HTMLElement - элемент для отображения названия товара
- _priceElement: HTMLElement - элемент для отображения цены товара
- _buttonElement: HTMLButtonElement - кнопка удаления товара
- _product: IProduct - данные товара

Методы
Сеттеры
- product: IProduct - устанавливает данные товара (название и цену)
- counter: number - устанавливает порядковый номер товара в корзине

Обработчики событий
Клик по кнопке удаления товара генерирует событие 'cart:delete-item' с идентификатором товара

#### Класс ViewOrderContactModal
Класс расширяет базовый Component и реализует модальное окно ввода контактных данных для заказа. Отвечает за валидацию формы, обработку ввода данных и отправку формы.

Конструктор
- container: HTMLTemplateElement - шаблон контейнера модального окна
- events: EventEmitter - система событий для обработки пользовательских действий и передачи данных

Элементы разметки
- [name="email"] - поле ввода email (сохраняется в _inputEmail)
- [name="phone"] - поле ввода телефона (сохраняется в _inputPhone)
- button[type=submit] - кнопка отправки формы (сохраняется в _submitButton)

Поля класса
- _inputEmail: HTMLInputElement - поле ввода email
- _inputPhone: HTMLInputElement - поле ввода телефона
- _submitButton: HTMLButtonElement - кнопка отправки формы

Методы
Публичные методы
- isLoading(state: boolean): void - управляет состоянием кнопки отправки (блокировка/разблокировка, изменение текста)

Приватные методы
- updateSubmitButtonState(): void - обновляет состояние кнопки отправки на основе валидности формы
- isFormValid(): boolean - проверяет валидность формы (оба поля заполнены)

Обработчики событий
- Ввод данных в поле email генерирует событие 'inputUser:changed' с данными поля
- Ввод данных в поле phone генерирует событие 'inputUser:changed' с данными поля
- Клик по кнопке отправки генерирует событие 'finish:click' при валидной форме

#### Класс ViewOrderModal
Класс расширяет базовый Component и реализует модальное окно оформления заказа. Отвечает за выбор способа оплаты, ввод адреса доставки и валидацию формы заказа.
Конструктор
- container: HTMLTemplateElement - шаблон контейнера модального окна оформления заказа
- events: EventEmitter - система событий для обработки пользовательских действий и передачи данных

Элементы разметки
- .order - форма заказа (сохраняется в _order)
- [name="card"] - кнопка выбора онлайн-оплаты (сохраняется в _cardButton)
- [name="cash"] - кнопка выбора оплаты при получении (сохраняется в _cashButton)
- [name="address"] - поле ввода адреса доставки (сохраняется в _inputAddress)
- button[type=submit] - кнопка отправки формы (сохраняется в _submitButton)

Поля класса
- _order: HTMLFormElement - форма оформления заказа
- _cardButton: HTMLButtonElement - кнопка выбора онлайн-оплаты
- _cashButton: HTMLButtonElement - кнопка выбора оплаты при получении
- _inputAddress: HTMLInputElement - поле ввода адреса доставки
- _submitButton: HTMLButtonElement - кнопка перехода к следующему шагу
- _isPaymentSelected: boolean - флаг выбора способа оплаты

Методы
Публичные методы
- setPaymentMethod(method: 'card' | 'cash'): void - устанавливает выбранный способ оплаты и меняет стиль кнопок
Приватные методы
- updateSubmitButtonState(): void - обновляет состояние кнопки отправки на основе валидности формы
- isFormValid(): boolean - проверяет валидность формы (выбран способ оплаты и заполнен адрес)

Обработчики событий
- Клик по кнопке онлайн-оплаты генерирует событие 'inputUser:changed' с значением 'card'
- Клик по кнопке оплаты при получении генерирует событие 'inputUser:changed' с значением 'cash'
- Ввод данных в поле адреса генерирует событие 'inputUser:changed' с введенным значением
- Клик по кнопке отправки генерирует событие 'order:proceed' при валидной форме

#### Класс ViewProductItem
Класс расширяет базовый Component и реализует карточку товара в каталоге. Отвечает за отображение информации о товаре и обработку кликов по карточке.

Конструктор
- container: HTMLElement - корневой элемент карточки товара
- events: EventEmitter - система событий для обработки пользовательских действий

Элементы разметки
- .card__title - элемент названия товара (сохраняется в titleElement)
- .card__image - изображение товара (сохраняется в imageElement)
- .card__category - элемент категории товара (сохраняется в categoryElement)
- .card__price - элемент цены товара (сохраняется в priceElement)

Поля класса
- titleElement: HTMLElement - элемент для отображения названия товара
- imageElement: HTMLImageElement - элемент для отображения изображения товара
- categoryElement: HTMLElement - элемент для отображения категории товара
- priceElement: HTMLElement - элемент для отображения цены товара
- _product: IProduct - данные товара

Методы
Сеттеры
- product: IProduct - устанавливает данные товара: название, изображение, категорию (с применением соответствующего CSS-класса), цену

Обработчики событий
- Клик по карточке товара генерирует событие 'item:click' с идентификатором товара

Автоматически применяет CSS-классы в зависимости от категории товара:
- card__category_soft для 'софт-скил'
- card__category_hard для 'хард-скил'
- card__category_other для 'другое'
- card__category_additional для 'дополнительное'
- card__category_button для 'кнопка'
Для товаров без цены отображает текст 'Бесценно'

#### Класс ViewProductModal
Класс расширяет базовый Component и реализует модальное окно просмотра товара. Отвечает за отображение детальной информации о товаре и управление добавлением/удалением из корзины.

Конструктор
- container: HTMLElement - корневой элемент модального окна товара
- events: IEvents - система событий для обработки пользовательских действий

Элементы разметки
- .card__title - элемент названия товара (сохраняется в _titleElement)
- .card__text - элемент описания товара (сохраняется в _descriptionElement)
- .card__price - элемент цены товара (сохраняется в _priceElement)
- .card__image - изображение товара (сохраняется в _imageElement)
- .card__category - элемент категории товара (сохраняется в _categoryElement)
- .card__button - кнопка действия с товаром (сохраняется в _buttonElement)

Поля класса
- _imageElement: HTMLImageElement - элемент изображения товара
- _categoryElement: HTMLElement - элемент категории товара
- _titleElement: HTMLElement - элемент названия товара
- _descriptionElement: HTMLElement - элемент описания товара
- _priceElement: HTMLElement - элемент цены товара
- _buttonElement: HTMLButtonElement - кнопка действия (добавить/удалить из корзины)
- _isActive: boolean - флаг активности
- _product: IProduct - данные товара
- _selectedCart: boolean - флаг наличия товара в корзине

Методы
Сеттеры
- product: IProduct - устанавливает данные товара: название, описание, цену, изображение, категорию (с применением соответствующего CSS-класса), управляет состоянием кнопки
- selectedCart: boolean - устанавливает состояние товара в корзине, меняет текст и поведение кнопки

Обработчики событий
- Клик по кнопке генерирует событие 'cart:delete-item' (если товар в корзине) или 'cart:add-item' (если товара нет в корзине)

Автоматически применяет CSS-классы в зависимости от категории товара
Для товаров без цены блокирует кнопку и отображает "Недоступно"
Меняет текст кнопки в зависимости от состояния товара в корзине ("Купить"/"Убрать из корзины")

#### Класс ViewSuccessModal
Класс расширяет базовый Component и реализует модальное окно успешного оформления заказа. Отвечает за отображение информации о списанной сумме и обработку закрытия окна.

Конструктор
- container: HTMLElement - корневой элемент модального окна успешного заказа
- events: IEvents - система событий для обработки пользовательских действий

Элементы разметки
- .order-success__close - кнопка закрытия модального окна (сохраняется в _buttonClose)
- .order-success__description - элемент отображения информации о списанной сумме (сохраняется в _totalPrice)

Поля класса
- _form: HTMLFormElement - форма (не используется в текущей реализации)
- _image: string - изображение (не используется в текущей реализации)
- _totalPrice: HTMLElement - элемент для отображения суммы списания
- _buttonClose: HTMLButtonElement - кнопка закрытия модального окна

Методы
Сеттеры
- totalPrice: string - устанавливает текст с информацией о списанной сумме

Обработчики событий
- Клик по кнопке закрытия генерирует событие 'closes:click'

Отображает сообщение о списанной сумме в формате "Списано {сумма} синапсов"
Предоставляет кнопку для закрытия модального окна и продолжения покупок


### Слой презентера

#### Класс IWebLarekAPI
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов (описать свои события)!!!!!!
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `items:changed` - изменение списка товаров
- `cart:changed` - изменение состава корзины
- `order.payment:changed` - изменение способа оплаты
- `order.address:changed` - изменение адреса доставки  
- `order.email:changed` - изменение email
- `order.phone:changed` - изменение телефона
- `order:changed` - общее изменение данных заказа

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `item:click` - клик по товару для просмотра деталей
- `cart:add-item` - добавление товара в корзину
- `cart:delete-item` - удаление товара из корзины
- `cart:open` - открытие корзины
- `cart:order` - оформление заказа
- `order:proceed` - переход к контактным данным
- `finish:click` - завершение оформления заказа
- `closes:click` - закрытие окна успеха
- `inputUser:changed` - изменение данных в формах